diff -Nuar badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/SocksUdpGwClient.c badvpn/tun2socks/SocksUdpGwClient.c
--- badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/SocksUdpGwClient.c	2017-09-07 09:19:49.000000000 +0000
+++ badvpn/tun2socks/SocksUdpGwClient.c	2017-12-24 07:00:00.000000000 +0000
@@ -33,7 +33,7 @@
 
 #include <generated/blog_channel_SocksUdpGwClient.h>
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
 
 #include <misc/socks_proto.h>
 #define CONNECTION_UDP_BUFFER_SIZE 1
@@ -49,7 +49,7 @@
 
 #endif
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
 static void dgram_handler (SocksUdpGwClient_connection *o, int event);
 static void dgram_handler_received (SocksUdpGwClient_connection *o, uint8_t *data, int data_len);
 static int conaddr_comparator (void *unused, SocksUdpGwClient_conaddr *v1, SocksUdpGwClient_conaddr *v2);
@@ -499,7 +499,7 @@
 {
     // see asserts in UdpGwClient_Init
     ASSERT(!BAddr_IsInvalid(&socks_server_addr))
-#ifndef __ANDROID__
+#ifndef ANDROID_UDP
     ASSERT(remote_udpgw_addr.type == BADDR_TYPE_IPV4 || remote_udpgw_addr.type == BADDR_TYPE_IPV6)
 #endif
 
@@ -514,7 +514,7 @@
     o->handler_received = handler_received;
     o->dnsgw = dnsgw;
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
     // compute MTUs
     o->udpgw_mtu = udpgw_compute_mtu(o->udp_mtu);
     o->max_connections = max_connections;
@@ -559,7 +559,7 @@
 {
     DebugObject_Free(&o->d_obj);
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
     // free connections
     while (!LinkedList1_IsEmpty(&o->connections_list)) {
         SocksUdpGwClient_connection *con = UPPER_OBJECT(LinkedList1_GetFirst(&o->connections_list), SocksUdpGwClient_connection, connections_list_node);
@@ -584,7 +584,7 @@
     DebugObject_Access(&o->d_obj);
     // see asserts in UdpGwClient_SubmitPacket
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
     ASSERT(local_addr.type == BADDR_TYPE_IPV4 || local_addr.type == BADDR_TYPE_IPV6)
     ASSERT(remote_addr.type == BADDR_TYPE_IPV4 || remote_addr.type == BADDR_TYPE_IPV6)
     ASSERT(data_len >= 0)
diff -Nuar badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/SocksUdpGwClient.h badvpn/tun2socks/SocksUdpGwClient.h
--- badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/SocksUdpGwClient.h	2017-09-07 09:19:49.000000000 +0000
+++ badvpn/tun2socks/SocksUdpGwClient.h	2017-12-24 07:00:00.000000000 +0000
@@ -32,7 +32,7 @@
 #include <misc/debug.h>
 #include <base/DebugObject.h>
 #include <system/BReactor.h>
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
 #include <protocol/udpgw_proto.h>
 #include <protocol/packetproto.h>
 #include <system/BDatagram.h>
@@ -59,7 +59,7 @@
     BReactor *reactor;
     void *user;
     SocksUdpGwClient_handler_received handler_received;
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
     int udpgw_mtu;
     int num_connections;
     int max_connections;
@@ -75,7 +75,7 @@
     DebugObject d_obj;
 } SocksUdpGwClient;
 
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
 typedef struct {
     BAddr local_addr;
     BAddr remote_addr;
diff -Nuar badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/tun2socks.c badvpn/tun2socks/tun2socks.c
--- badvpn-58f8a8883e51e5cb97391c4b6733ce255bf11f95/tun2socks/tun2socks.c	2017-09-07 09:19:49.000000000 +0000
+++ badvpn/tun2socks/tun2socks.c	2017-12-24 07:00:00.000000000 +0000
@@ -406,8 +406,8 @@
 
     if (options.fake_proc) {
         // Fake process name to cheat on Lollipop
-        strcpy(argv[0], "com.github.shadowsocks");
-        prctl(PR_SET_NAME, "com.github.shadowsocks");
+        strcpy(argv[0], "net.typeblog.socks");
+        prctl(PR_SET_NAME, "net.typeblog.socks");
     }
 
     // handle --help and --version
@@ -500,7 +500,7 @@
         goto fail2;
     }
 
-    char *path = "/data/data/com.github.shadowsocks/sock_path";
+    char *path = "/data/data/net.typeblog.socks/sock_path";
     if (options.sock_path != NULL) {
         path = options.sock_path;
     }
@@ -734,7 +734,7 @@
         "        [--password <password>]\n"
         "        [--password-file <file>]\n"
         "        [--append-source-to-username]\n"
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
         "        [--enable-udprelay]\n"
         "        [--udprelay-max-connections <number>]\n"
 #else
@@ -987,7 +987,7 @@
         else if (!strcmp(arg, "--append-source-to-username")) {
             options.append_source_to_username = 1;
         }
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
         else if (!strcmp(arg, "--enable-udprelay")) {
             options.udpgw_remote_server_addr = "0.0.0.0:0";
 #else
@@ -1000,7 +1000,7 @@
             i++;
 #endif
         }
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
         else if (!strcmp(arg, "--udprelay-max-connections")) {
 #else
         else if (!strcmp(arg, "--udpgw-max-connections")) {
@@ -1015,7 +1015,7 @@
             }
             i++;
         }
-#ifndef __ANDROID__
+#ifndef ANDROID_UDP
         else if (!strcmp(arg, "--udpgw-connection-buffer-size")) {
             if (1 >= argc - i) {
                 fprintf(stderr, "%s: requires an argument\n", arg);
@@ -1137,7 +1137,7 @@
     // resolve remote udpgw server address
     if (options.udpgw_remote_server_addr) {
         if (!BAddr_Parse2(&udpgw_remote_server_addr, options.udpgw_remote_server_addr, NULL, 0, 0)) {
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
             BLog(BLOG_ERROR, "udprelay server addr: BAddr_Parse2 failed");
 #else
             BLog(BLOG_ERROR, "remote udpgw server addr: BAddr_Parse2 failed");
@@ -2165,14 +2165,14 @@
         } break;
 
         case BADDR_TYPE_IPV6: {
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
             BLog(BLOG_INFO, "UDP/IPv6: from udprelay %d bytes", data_len);
 #else
             BLog(BLOG_INFO, "UDP/IPv6: from udpgw %d bytes", data_len);
 #endif
 
             if (!options.netif_ip6addr) {
-#ifdef __ANDROID__
+#ifdef ANDROID_UDP
                 BLog(BLOG_ERROR, "got IPv6 packet from udprelay but IPv6 is disabled");
 #else
                 BLog(BLOG_ERROR, "got IPv6 packet from udpgw but IPv6 is disabled");
